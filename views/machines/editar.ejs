<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar Máquina - Gestor de Serviços</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-900 text-white">
    <div class="min-h-screen flex flex-col justify-center items-center px-4 py-8">
      <div class="flex flex-col items-center mb-8">
        <svg class="w-16 h-16 mb-3 text-teal-400" fill="currentColor" viewBox="0 0 640 512">
          <path d="M96 64c0-35.3 28.7-64 64-64H266.3c26.2 0 49.7 15.9 59.4 40.2L373.7 160H480V126.2c0-24.8 5.8-49.3 16.9-71.6l2.5-5c7.9-15.8 27.1-22.2 42.9-14.3s22.2 27.1 14.3 42.9l-2.5 5c-6.7 13.3-10.1 28-10.1 42.9V160h56c22.1 0 40 17.9 40 40v45.4c0 16.5-8.5 31.9-22.6 40.7l-43.3 27.1c-14.2-5.9-29.8-9.2-46.1-9.2c-39.3 0-74.1 18.9-96 48H352c0 17.7-14.3 32-32 32h-8.2c-1.7 4.8-3.7 9.5-5.8 14.1l5.8 5.8c12.5 12.5 12.5 32.8 0 45.3l-22.6 22.6c-12.5 12.5-32.8 12.5-45.3 0l-5.8-5.8c-4.6 2.2-9.3 4.1-14.1 5.8V480c0 17.7-14.3 32-32 32H160c-17.7 0-32-14.3-32-32v-8.2c-4.8-1.7-9.5-3.7-14.1-5.8l-5.8 5.8c-12.5 12.5-32.8 12.5-45.3 0L40.2 449.1c-12.5-12.5-12.5-32.8 0-45.3l5.8-5.8c-2.2-4.6-4.1-9.3-5.8-14.1H32c-17.7 0-32-14.3-32-32V320c0-17.7 14.3-32 32-32h8.2c1.7-4.8 3.7-9.5 5.8-14.1l-5.8-5.8c-12.5-12.5-12.5-32.8 0-45.3l22.6-22.6c12.5-12.5 32.8-12.5 45.3 0l5.8 5.8c4.6-2.2 9.3-4.1 14.1-5.8V192c0-17.7 14.3-32 32-32h50.7L266.3 64H160V96c0 17.7-14.3 32-32 32s-32-14.3-32-32V64zM160 320a96 96 0 1 1 0 192 96 96 0 1 1 0-192zm368 96a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/>
        </svg>
        <h2 class="text-2xl font-bold text-teal-400">Editar Máquina</h2>
      </div>

      <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md border border-teal-600">
        <form action="/machines/edit/<%= machine.id %>" method="POST" class="flex flex-col gap-4">
        <div class="flex flex-col">
          <label for="name" class="font-semibold text-teal-300">Nome da Máquina*</label>
          <input
            type="text"
            name="name"
            id="name"
            value="<%= machine.name %>"
            required
            class="bg-gray-700 text-white border border-gray-600 rounded-md px-3 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
          />
        </div>

        <div class="flex flex-col">
          <label for="type" class="font-semibold text-teal-300">Tipo*</label>
          <select
            name="type"
            id="type"
            required
            class="bg-gray-700 text-white border border-gray-600 rounded-md px-3 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
          >
            <option value="Trator" <%= machine.type === 'Trator' ? 'selected' : '' %>>Trator</option>
            <option value="Pá Carregadeira" <%= machine.type === 'Pá Carregadeira' ? 'selected' : '' %>>Pá Carregadeira</option>
            <option value="Retroescavadeira" <%= machine.type === 'Retroescavadeira' ? 'selected' : '' %>>Retroescavadeira</option>
            <option value="Colheitadeira" <%= machine.type === 'Colheitadeira' ? 'selected' : '' %>>Colheitadeira</option>
            <option value="Pulverizador" <%= machine.type === 'Pulverizador' ? 'selected' : '' %>>Pulverizador</option>
            <option value="Outro" <%= machine.type === 'Outro' ? 'selected' : '' %>>Outro</option>
          </select>
        </div>

        <div class="flex flex-col">
          <label for="hourlyRate" class="font-semibold text-teal-300">Valor da Hora (R$)*</label>
          <input
            type="number"
            step="0.01"
            name="hourlyRate"
            id="hourlyRate"
            value="<%= machine.hourlyRate %>"
            required
            class="bg-gray-700 text-white border border-gray-600 rounded-md px-3 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
          />
        </div>

        <div class="flex flex-col">
          <label for="plate" class="font-semibold text-teal-300">Placa</label>
          <input
            type="text"
            name="plate"
            id="plate"
            value="<%= machine.plate || '' %>"
            class="bg-gray-700 text-white border border-gray-600 rounded-md px-3 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
          />
        </div>

        <div class="flex flex-col">
          <label for="notes" class="font-semibold text-teal-300">Observações</label>
          <textarea
            name="notes"
            id="notes"
            rows="4"
            class="bg-gray-700 text-white border border-gray-600 rounded-md px-3 py-3 focus:outline-none focus:ring-2 focus:ring-teal-500"
          ><%= machine.notes || '' %></textarea>
        </div>

        <button
          type="submit"
          class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 border-2 border-teal-400 inline-flex items-center justify-center gap-2 shadow-lg hover:shadow-xl mt-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Salvar Alterações
        </button>
      </form>
      
      <!-- Botões de Navegação -->
      <div class="mt-6 flex flex-col gap-3">
        <a
          href="/machines"
          class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 border-2 border-gray-600 inline-flex items-center justify-center gap-2 shadow-md hover:shadow-lg"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Voltar para Máquinas
        </a>
        <a
          href="/dashboard"
          class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 border-2 border-gray-600 inline-flex items-center justify-center gap-2 shadow-md hover:shadow-lg"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          Voltar ao Painel
        </a>
      </div>
    </div>

    <script>
      // Verifica autenticação ao carregar a página
      window.addEventListener('pageshow', async function(event) {
        try {
          const response = await fetch('/api/check-auth');
          if (!response.ok) {
            window.location.replace('/users/login');
          }
        } catch (error) {
          window.location.replace('/users/login');
        }
      });
    </script>
  </body>
</html>
